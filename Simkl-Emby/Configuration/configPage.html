<!DOCTYPE html>
<html>
<head>
    <title>Simkl's TV Tracker</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage" id="SimklConfigurationPage" data-require="emby-button,emby-checkbox,emby-input,emby-select">
        <div data-role="content">
            <div class="content-primary">
                <h1>Simkl's TV Tracker</h1>
                <form id="SimklConfigurationForm">
                    <div id="selectContainer">
                        <select is="emby-select" id="user-selector" label="Showing plugin settings for...">
                            <!-- This will be populated by SimklConfig.populateUsers -->
                        </select>
                    </div>
                    <div id="loginButtonContainer">
                        <h3>It seems you are not logged in, do you wish to log in?</h3>
                        <button is="emby-button" type="button" class="raised button-submit block"><span>Log In</span></button>
                        <button is="emby-button" type="button" class="raised block"><span>Create an account</span></button>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript">
            var SimklConfig = {
                guid: "2ecd91d5-b14b-4b92-8eb9-52c098edfc87",
                populateUsers : async function (users) {
                    users.forEach(function(user) {
                        $("#user-selector").append(new Option(user.Name, user.Id));
                    });
                },
                loadConfig : async function(user, config) {
                    console.log("Simkl: Loading config for user " + user);
                    console.log(config);
                }
            }

            $("#SimklConfigurationPage").on("pageshow", async function(e) {
                Dashboard.alert("WARNING: This is only a prototype, not currently working!");
                Dashboard.showLoadingMsg();
                await Promise.all([
                    ApiClient.getUsers().then(SimklConfig.populateUsers),
                    ApiClient.getPluginConfiguration(SimklConfig.guid).then(SimklConfig.loadConfig.bind(null, ApiClient.getCurrentUserId()))]);
                Dashboard.hideLoadingMsg();
            });
        </script>
    </div>
</body>
</html>